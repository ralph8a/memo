// Krause Insurance Web App - Main JavaScript

// User session management
let currentUser = null;
let currentPage = 'home';

// Check if user is logged in
function checkAuth() {
    const user = localStorage.getItem('krauser_user');
    if (user) {
        currentUser = JSON.parse(user);
        return true;
    }
    return false;
}

// Logout function
function logout() {
    localStorage.removeItem('krauser_user');
    currentUser = null;
    navigateTo('home');
    showNotification('SesiÃ³n cerrada exitosamente', 'success');
}

// Show notification
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.classList.add('show');
    }, 10);

    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Toggle mobile menu
function toggleMobileMenu() {
    const navMenu = document.getElementById('navMenu');
    navMenu.classList.toggle('active');
}

// Navigation function
function navigateTo(page, event) {
    if (event) {
        event.preventDefault();
    }

    currentPage = page;

    // Close mobile menu
    const navMenu = document.getElementById('navMenu');
    navMenu.classList.remove('active');

    // Update active nav link
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.dataset.page === page) {
            link.classList.add('active');
        }
    });

    // Hide footer on certain pages
    const footer = document.getElementById('footer');
    if (['login', 'agent-login', 'dashboard', 'agent-dashboard'].includes(page)) {
        footer.style.display = 'none';
    } else {
        footer.style.display = 'block';
    }

    // Load page content
    loadPage(page);

    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Page templates
const pages = {
    home: `
    <div class="animation-progress-bar" id="animation-progress">
      <div class="progress-fill"></div>
    </div>
    
    <nav class="sub-navigation sub-nav-hidden" id="sub-nav">
      <button class="sub-nav-btn active" data-section="hero" onclick="showHomeSection('hero')">Hero</button>
      <button class="sub-nav-btn" data-section="eleccion" onclick="showHomeSection('eleccion')">ElecciÃ³n</button>
      <button class="sub-nav-btn" data-section="cotiza" onclick="showHomeSection('cotiza')">Cotizar</button>
    </nav>
    
    <section class="hero-section hero-intro home-section active" id="hero-section">
      <div class="hero-content">
        <h1 class="hero-title">
          <span class="title-word">Protection</span>
          <span class="title-word accent">Beyond</span>
          <span class="title-word">The Limits</span>
        </h1>
        <p class="hero-subtitle">
          MÃ¡s de 25 aÃ±os protegiendo lo que mÃ¡s valoras. 
          Seguros personalizados respaldados por experiencia y compromiso.
        </p>
        
        <div class="hero-stats">
          <div class="stat-box stat-pulse">
            <div class="stat-icon-mini">â³</div>
            <div class="stat-number" data-target="25">0</div>
            <div class="stat-label">AÃ±os de Experiencia</div>
          </div>
          <div class="stat-box stat-pulse" style="animation-delay: 0.1s">
            <div class="stat-icon-mini">ğŸ‘¥</div>
            <div class="stat-number" data-target="5000">0</div>
            <div class="stat-label">Clientes Activos</div>
          </div>
          <div class="stat-box stat-pulse" style="animation-delay: 0.2s">
            <div class="stat-icon-mini">ğŸ“</div>
            <div class="stat-number" data-target="10000">0</div>
            <div class="stat-label">PÃ³lizas Vigentes</div>
          </div>
          <div class="stat-box stat-pulse" style="animation-delay: 0.3s">
            <div class="stat-icon-mini">â­</div>
            <div class="stat-number" data-target="98">0</div>
            <div class="stat-label">% SatisfacciÃ³n</div>
          </div>
        </div>
        
        <button class="btn-home-start" onclick="skipToFinalState()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
          Saltar AnimaciÃ³n
        </button>
      </div>
    </section>
    
    <section class="features-section features-parade home-section" id="eleccion-section">
      <div class="features-content">
        <h2 class="section-title">Â¿Por QuÃ© Elegirnos?</h2>
        <div class="features-grid">
          <div class="feature-box feature-card-1">
            <div class="feature-icon icon-bounce">ğŸ›¡ï¸</div>
            <h3>Cobertura Integral</h3>
            <p>ProtecciÃ³n completa adaptada a tus necesidades especÃ­ficas</p>
          </div>
          <div class="feature-box feature-card-2">
            <div class="feature-icon icon-pulse">âš¡</div>
            <h3>Respuesta Inmediata</h3>
            <p>AtenciÃ³n 24/7 cuando mÃ¡s nos necesitas</p>
          </div>
          <div class="feature-box feature-card-3">
            <div class="feature-icon icon-shake">ğŸ’°</div>
            <h3>Mejores Precios</h3>
            <p>Cotizamos con mÃºltiples aseguradoras para ti</p>
          </div>
          <div class="feature-box feature-card-4">
            <div class="feature-icon icon-bounce">ğŸ‘¨â€ğŸ’¼</div>
            <h3>AsesorÃ­a Experta</h3>
            <p>25+ aÃ±os de experiencia a tu servicio</p>
          </div>
        </div>
        
        <div class="testimonials-container">
          <div class="testimonial-quick">
            <div class="testimonial-avatar">ğŸ‘¨</div>
            <div class="testimonial-content">
              <p class="testimonial-text">â€œExcelente servicio y atenciÃ³n. Me ayudaron a encontrar la mejor cobertura para mi familia.â€</p>
              <p class="testimonial-author">- Roberto M., Cliente desde 2018</p>
            </div>
          </div>
          
          <div class="testimonial-quick" style="animation-delay: 0.7s">
            <div class="testimonial-avatar">ğŸ‘©</div>
            <div class="testimonial-content">
              <p class="testimonial-text">â€œProfesionales y confiables. Resolvieron mi siniestro en tiempo rÃ©cord.â€</p>
              <p class="testimonial-author">- MarÃ­a L., Cliente desde 2020</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <section class="cta-section final-cta home-section" id="cotiza-section">
      <div class="container">
        <div class="cta-hero-title">
          <svg class="cta-logo-large" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
            <ellipse class="shield-circle" cx="40" cy="38" rx="22" ry="22" stroke="currentColor" stroke-width="3" fill="none" />
            <path class="shield-diamond" d="M40 12 L62 35 L40 70 L18 35 Z" stroke="currentColor" stroke-width="3" fill="none" />
            <path class="shield-arc" d="M24 50 Q40 30 56 50" stroke="currentColor" stroke-width="3" fill="none" />
            <line class="shield-line" x1="40" y1="50" x2="40" y2="68" stroke="currentColor" stroke-width="3" />
          </svg>
          <h2 class="animated-title main-hero">
            <span class="title-line">Â¿Listo para</span>
            <span class="title-line highlight">Proteger</span>
            <span class="title-line">tu Futuro?</span>
          </h2>
          <div class="title-underline"></div>
        </div>
        
        <p class="cta-subtitle">ObtÃ©n una cotizaciÃ³n personalizada sin compromiso</p>
        
        <div class="cta-buttons cta-main-buttons">
          <button class="btn btn-primary btn-lg btn-pulse" onclick="navigateTo('contact')">
            <span>ğŸ“ Solicitar CotizaciÃ³n Gratis</span>
          </button>
          <button class="btn btn-secondary btn-lg" onclick="navigateTo('services')">
            <span>ğŸ›¡ï¸ Ver Servicios</span>
          </button>
        </div>
        
        <div class="section-divider"></div>
        
        <h3 class="agents-section-title">Contacta a Nuestros Agentes</h3>
        
        <div class="agents-grid">
          <div class="agent-card">
            <div class="agent-avatar">ğŸ‘¨â€ğŸ’¼</div>
            <h4>Carlos MÃ©ndez</h4>
            <p class="agent-title">Agente Senior</p>
            <a href="tel:+525512345678" class="agent-contact">ğŸ“ (55) 1234-5678</a>
          </div>
          
          <div class="agent-card">
            <div class="agent-avatar">ğŸ‘©â€ğŸ’¼</div>
            <h4>Ana RodrÃ­guez</h4>
            <p class="agent-title">Especialista Vida</p>
            <a href="tel:+525598765432" class="agent-contact">ğŸ“ (55) 9876-5432</a>
          </div>
          
          <div class="agent-card">
            <div class="agent-avatar">ğŸ‘¨â€ğŸ’¼</div>
            <h4>Miguel Torres</h4>
            <p class="agent-title">Seguros Auto</p>
            <a href="tel:+525555551234" class="agent-contact">ğŸ“ (55) 5555-1234</a>
          </div>
          
          <div class="agent-card">
            <div class="agent-avatar">ğŸ‘©â€ğŸ’¼</div>
            <h4>Laura GÃ³mez</h4>
            <p class="agent-title">Seguros Hogar</p>
            <a href="tel:+525544445555" class="agent-contact">ğŸ“ (55) 4444-5555</a>
          </div>
        </div>
      </div>
    </section>
  `,

    services: `
<section class="services-fullpage">
  <div class="services-container">
    <div class="services-header-compact">
      <h1 class="services-main-title">Nuestros Servicios</h1>
      <p class="services-main-subtitle">Cobertura completa para todas tus necesidades</p>
    </div>
    
    <div class="services-grid-compact">
      <div class="service-card-compact card-1">
        <div class="service-icon-compact">ğŸš—</div>
        <h3 class="service-name-compact">Seguros de Auto</h3>
        <p class="service-desc-compact">ProtecciÃ³n completa para tu vehÃ­culo con las mejores coberturas del mercado.</p>
        <ul class="service-features-compact">
          <li>âœ“ Responsabilidad Civil</li>
          <li>âœ“ Cobertura Amplia</li>
          <li>âœ“ Asistencia Vial 24/7</li>
          <li>âœ“ Auto de Reemplazo</li>
          <li>âœ“ Cristales y Robo</li>
        </ul>
        <button class="btn-compact" onclick="window.appHandlers.openQuoteModal('auto')">Cotizar Ahora</button>
      </div>

      <div class="service-card-compact card-2 featured-compact">
        <div class="badge-compact">MÃS POPULAR</div>
        <div class="service-icon-compact">ğŸ </div>
        <h3 class="service-name-compact">Seguros de Hogar</h3>
        <p class="service-desc-compact">Tu patrimonio protegido contra todo tipo de riesgos y eventualidades.</p>
        <ul class="service-features-compact">
          <li>âœ“ DaÃ±os Estructurales</li>
          <li>âœ“ Contenido y Bienes</li>
          <li>âœ“ Responsabilidad Civil</li>
          <li>âœ“ Desastres Naturales</li>
          <li>âœ“ Robo y Vandalismo</li>
        </ul>
        <button class="btn-compact primary-compact" onclick="window.appHandlers.openQuoteModal('hogar')">Cotizar Ahora</button>
      </div>

      <div class="service-card-compact card-3">
        <div class="service-icon-compact">â¤ï¸</div>
        <h3 class="service-name-compact">Seguros de Vida</h3>
        <p class="service-desc-compact">Asegura el futuro de tus seres queridos con planes flexibles y accesibles.</p>
        <ul class="service-features-compact">
          <li>âœ“ Cobertura Familiar</li>
          <li>âœ“ Planes Personalizados</li>
          <li>âœ“ Beneficios por Invalidez</li>
          <li>âœ“ Enfermedades Graves</li>
          <li>âœ“ Ahorro e InversiÃ³n</li>
        </ul>
        <button class="btn-compact" onclick="window.appHandlers.openQuoteModal('vida')">Cotizar Ahora</button>
      </div>

      <div class="service-card-compact card-4">
        <div class="service-icon-compact">ğŸ¢</div>
        <h3 class="service-name-compact">Seguros Comerciales</h3>
        <p class="service-desc-compact">ProtecciÃ³n integral para tu negocio y continuidad operativa.</p>
        <ul class="service-features-compact">
          <li>âœ“ Responsabilidad General</li>
          <li>âœ“ Propiedad Comercial</li>
          <li>âœ“ CompensaciÃ³n Laboral</li>
          <li>âœ“ InterrupciÃ³n de Negocio</li>
          <li>âœ“ Cyber Seguridad</li>
        </ul>
        <button class="btn-compact" onclick="window.appHandlers.openQuoteModal('comercial')">Cotizar Ahora</button>
      </div>

      <div class="service-card-compact card-5">
        <div class="service-icon-compact">ğŸ’¼</div>
        <h3 class="service-name-compact">Seguros de Salud</h3>
        <p class="service-desc-compact">Acceso a los mejores servicios mÃ©dicos con cobertura amplia.</p>
        <ul class="service-features-compact">
          <li>âœ“ HospitalizaciÃ³n</li>
          <li>âœ“ CirugÃ­as y Tratamientos</li>
          <li>âœ“ Medicamentos</li>
          <li>âœ“ Red MÃ©dica Extensa</li>
          <li>âœ“ ExÃ¡menes Preventivos</li>
        </ul>
        <button class="btn-compact" onclick="window.appHandlers.openQuoteModal('salud')">Cotizar Ahora</button>
      </div>

      <div class="service-card-compact card-6">
        <div class="service-icon-compact">âœˆï¸</div>
        <h3 class="service-name-compact">Seguros de Viaje</h3>
        <p class="service-desc-compact">Viaja tranquilo con cobertura internacional completa.</p>
        <ul class="service-features-compact">
          <li>âœ“ Asistencia Mundial</li>
          <li>âœ“ Gastos MÃ©dicos</li>
          <li>âœ“ CancelaciÃ³n de Viaje</li>
          <li>âœ“ Equipaje Protegido</li>
          <li>âœ“ RepatriaciÃ³n</li>
        </ul>
        <button class="btn-compact" onclick="window.appHandlers.openQuoteModal('viaje')">Cotizar Ahora</button>
      </div>
    </div>
  </div>
</section>
  
  

  
  `,

    about: `
<section class="about-fullpage">
  <div class="about-container">
    <div class="about-header-main">
      <h1 class="about-main-title">Sobre Nosotros</h1>
      <p class="about-main-subtitle">Protection Beyond The Limits</p>
    </div>
    
    <div class="about-content-grid">
      <div class="about-story-card animated-card-1">
        <div class="about-icon">ğŸ“–</div>
        <h2 class="about-card-title">Nuestra Historia</h2>
        <p class="about-card-text">Con mÃ¡s de 25 aÃ±os de experiencia en el mercado asegurador, Krause Insurance se ha consolidado como lÃ­der en protecciÃ³n patrimonial, brindando tranquilidad a miles de familias y empresas en todo el paÃ­s.</p>
        <div class="about-stats-mini">
          <div class="stat-mini">
            <span class="stat-number">25+</span>
            <span class="stat-label">AÃ±os</span>
          </div>
          <div class="stat-mini">
            <span class="stat-number">50K+</span>
            <span class="stat-label">Clientes</span>
          </div>
        </div>
      </div>

      <div class="about-mission-card animated-card-2">
        <div class="about-icon">ğŸ¯</div>
        <h2 class="about-card-title">Nuestra MisiÃ³n</h2>
        <p class="about-card-text">Proporcionar soluciones de seguros personalizadas que no solo cumplan, sino que superen las expectativas de nuestros clientes, protegiendo lo que mÃ¡s valoran con excelencia y compromiso.</p>
        <ul class="about-values-list">
          <li><span class="value-icon">âœ“</span> Confianza y Transparencia</li>
          <li><span class="value-icon">âœ“</span> AtenciÃ³n Personalizada</li>
          <li><span class="value-icon">âœ“</span> InnovaciÃ³n Constante</li>
        </ul>
      </div>

      <div class="about-team-card animated-card-3">
        <div class="about-icon">ğŸ‘¥</div>
        <h2 class="about-card-title">Nuestro Equipo</h2>
        <p class="about-card-text">Contamos con un equipo de profesionales altamente capacitados y certificados, dedicados a brindar el mejor servicio y asesorÃ­a en cada etapa de tu protecciÃ³n.</p>
        <div class="team-grid-mini">
          <div class="team-member-mini">
            <div class="member-avatar">MK</div>
            <div class="member-name">MarÃ­a Krause</div>
            <div class="member-role">CEO</div>
          </div>
          <div class="team-member-mini">
            <div class="member-avatar">JR</div>
            <div class="member-name">John Rivera</div>
            <div class="member-role">Director</div>
          </div>
          <div class="team-member-mini">
            <div class="member-avatar">SC</div>
            <div class="member-name">Sara Chen</div>
            <div class="member-role">Asesora</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
  
  

  
  `,

    contact: `
<section class="contact-fullpage">
  <div class="contact-container">
    <div class="contact-header-main">
      <h1 class="contact-main-title">ContÃ¡ctanos</h1>
      <p class="contact-main-subtitle">Estamos aquÃ­ para ayudarte</p>
    </div>
    
    <div class="contact-content-wrapper">
      <div class="contact-info-section">
        <div class="contact-info-card animated-info-1">
          <div class="contact-info-icon">ğŸ“</div>
          <h3 class="contact-info-title">TelÃ©fono</h3>
          <a href="tel:+1234567890" class="contact-info-value">+1 (234) 567-890</a>
          <p class="contact-info-desc">Lun - Vie: 9:00 AM - 6:00 PM</p>
        </div>
        
        <div class="contact-info-card animated-info-2">
          <div class="contact-info-icon">âœ‰ï¸</div>
          <h3 class="contact-info-title">Email</h3>
          <a href="mailto:contact@krause.com" class="contact-info-value">contact@krause.com</a>
          <p class="contact-info-desc">Te respondemos en 24 horas</p>
        </div>
        
        <div class="contact-info-card animated-info-3">
          <div class="contact-info-icon">ğŸ“</div>
          <h3 class="contact-info-title">UbicaciÃ³n</h3>
          <p class="contact-info-value">Calle Principal 123</p>
          <p class="contact-info-desc">Ciudad, Estado 12345</p>
        </div>
      </div>
      
      <div class="contact-form-section">
        <form class="contact-form-modern" onsubmit="window.appHandlers.handleContactSubmit(event)">
          <div class="form-row-double">
            <div class="form-group-modern">
              <input type="text" class="form-input-modern" placeholder="Tu nombre" required>
            </div>
            <div class="form-group-modern">
              <input type="email" class="form-input-modern" placeholder="Tu email" required>
            </div>
          </div>
          <div class="form-row-double">
            <div class="form-group-modern">
              <input type="tel" class="form-input-modern" placeholder="TelÃ©fono">
            </div>
            <div class="form-group-modern">
              <select class="form-input-modern" required>
                <option value="">Selecciona un servicio</option>
                <option value="auto">Seguros de Auto</option>
                <option value="hogar">Seguros de Hogar</option>
                <option value="vida">Seguros de Vida</option>
                <option value="comercial">Seguros Comerciales</option>
                <option value="salud">Seguros de Salud</option>
                <option value="viaje">Seguros de Viaje</option>
              </select>
            </div>
          </div>
          <div class="form-group-modern">
            <textarea class="form-textarea-modern" placeholder="Tu mensaje" rows="3" required></textarea>
          </div>
          <button type="submit" class="btn-submit-modern">Enviar Mensaje</button>
          
          <div class="contact-social-card-inline">
            <h3 class="contact-social-title-inline">SÃ­guenos</h3>
            <div class="contact-social-icons-inline">
              <a href="#" class="social-icon-inline">ğŸ“˜</a>
              <a href="#" class="social-icon-inline">ğŸ“·</a>
              <a href="#" class="social-icon-inline">ğŸ¦</a>
              <a href="#" class="social-icon-inline">ğŸ’¼</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
  
  

  
  `,

    login: `
    <section class="auth-section">
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <svg class="logo-shield-auth" width="60" height="60" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
              <ellipse class="shield-circle" cx="40" cy="38" rx="22" ry="22" stroke="currentColor" stroke-width="3" fill="none" />
              <path class="shield-diamond" d="M40 12 L62 35 L40 70 L18 35 Z" stroke="currentColor" stroke-width="3" fill="none" />
              <path class="shield-arc" d="M24 50 Q40 30 56 50" stroke="currentColor" stroke-width="3" fill="none" />
              <line class="shield-line" x1="40" y1="50" x2="40" y2="68" stroke="currentColor" stroke-width="3" />
            </svg>
            <h2>Portal de Clientes</h2>
            <p>Accede a tu cuenta para revisar tus pÃ³lizas</p>
          </div>
          
          <form class="auth-form" onsubmit="handleClientLogin(event)">
            <div class="form-group">
              <label class="form-label">NÃºmero de PÃ³liza o Email</label>
              <input type="text" class="form-control" placeholder="Ingresa tu nÃºmero de pÃ³liza" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">ContraseÃ±a</label>
              <input type="password" class="form-control" placeholder="Ingresa tu contraseÃ±a" required>
            </div>
            
            <div class="form-options">
              <label class="checkbox-label">
                <input type="checkbox"> Recordarme
              </label>
              <a href="#" class="link-text">Â¿Olvidaste tu contraseÃ±a?</a>
            </div>
            
            <button type="submit" class="btn btn-primary btn-block">
              Iniciar SesiÃ³n
            </button>
          </form>
          
          <div class="auth-footer">
            <p>Â¿No tienes cuenta? <a href="#" onclick="navigateTo('contact')" class="link-text">ContÃ¡ctanos</a></p>
          </div>
          
          <div class="demo-credentials">
            <p><strong>Credenciales de Prueba:</strong></p>
            <p>Usuario: cliente@demo.com</p>
            <p>ContraseÃ±a: demo123</p>
          </div>
        </div>
      </div>
    </section>
  `,

    'agent-login': `
    <section class="auth-section">
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <svg class="logo-shield-auth" width="60" height="60" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
              <ellipse class="shield-circle" cx="40" cy="38" rx="22" ry="22" stroke="currentColor" stroke-width="3" fill="none" />
              <path class="shield-diamond" d="M40 12 L62 35 L40 70 L18 35 Z" stroke="currentColor" stroke-width="3" fill="none" />
              <path class="shield-arc" d="M24 50 Q40 30 56 50" stroke="currentColor" stroke-width="3" fill="none" />
              <line class="shield-line" x1="40" y1="50" x2="40" y2="68" stroke="currentColor" stroke-width="3" />
            </svg>
            <h2>Portal de Agentes</h2>
            <p>Acceso exclusivo para agentes certificados</p>
          </div>
          
          <form class="auth-form" onsubmit="handleAgentLogin(event)">
            <div class="form-group">
              <label class="form-label">ID de Agente</label>
              <input type="text" class="form-control" placeholder="Ingresa tu ID de agente" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">ContraseÃ±a</label>
              <input type="password" class="form-control" placeholder="Ingresa tu contraseÃ±a" required>
            </div>
            
            <div class="form-options">
              <label class="checkbox-label">
                <input type="checkbox"> Recordarme
              </label>
              <a href="#" class="link-text">Â¿Olvidaste tu contraseÃ±a?</a>
            </div>
            
            <button type="submit" class="btn btn-primary btn-block">
              Iniciar SesiÃ³n
            </button>
          </form>
          
          <div class="auth-footer">
            <p>Â¿Nuevo agente? <a href="#" onclick="showAgentRegistration()" class="link-text">Solicita acceso</a></p>
          </div>
          
          <div class="demo-credentials">
            <p><strong>Credenciales de Prueba:</strong></p>
            <p>Agente: agente@demo.com</p>
            <p>ContraseÃ±a: agent123</p>
          </div>
        </div>
      </div>
    </section>
  `
};

// Client Dashboard
pages.dashboard = `
  <section class="dashboard-section">
    <div class="dashboard-container">
      <div class="dashboard-header">
        <div>
          <h1>Mi Dashboard</h1>
          <p>Bienvenido, ${currentUser?.name || 'Cliente'}</p>
        </div>
        <button class="btn btn-outline" onclick="logout()">Cerrar SesiÃ³n</button>
      </div>
      
      <div class="dashboard-stats">
        <div class="dashboard-stat-card">
          <div class="stat-icon">ğŸ“„</div>
          <div class="stat-info">
            <div class="stat-value">3</div>
            <div class="stat-label">PÃ³lizas Activas</div>
          </div>
        </div>
        <div class="dashboard-stat-card">
          <div class="stat-icon">âœ…</div>
          <div class="stat-info">
            <div class="stat-value">Al DÃ­a</div>
            <div class="stat-label">Estado de Pagos</div>
          </div>
        </div>
        <div class="dashboard-stat-card">
          <div class="stat-icon">ğŸ“…</div>
          <div class="stat-info">
            <div class="stat-value">15 Mar</div>
            <div class="stat-label">PrÃ³ximo Pago</div>
          </div>
        </div>
        <div class="dashboard-stat-card">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-info">
            <div class="stat-value">$450</div>
            <div class="stat-label">Total Mensual</div>
          </div>
        </div>
      </div>
      
      <div class="dashboard-grid">
        <div class="dashboard-main">
          <div class="dashboard-card">
            <div class="card-header">
              <h3>Mis PÃ³lizas</h3>
              <button class="btn btn-sm btn-outline" onclick="showNotification('FunciÃ³n disponible prÃ³ximamente', 'info')">Nueva PÃ³liza</button>
            </div>
            <div class="policies-list">
              <div class="policy-item">
                <div class="policy-icon">ğŸš—</div>
                <div class="policy-info">
                  <h4>Seguro de Auto</h4>
                  <p>Toyota Camry 2022 â€¢ PÃ³liza #A-12345</p>
                  <div class="policy-meta">
                    <span class="badge badge-success">Activa</span>
                    <span>Vence: 15 Dic 2025</span>
                  </div>
                </div>
                <div class="policy-actions">
                  <button class="btn btn-sm btn-outline" onclick="viewPolicy('A-12345')">Ver Detalles</button>
                </div>
              </div>
              
              <div class="policy-item">
                <div class="policy-icon">ğŸ </div>
                <div class="policy-info">
                  <h4>Seguro de Hogar</h4>
                  <p>Propiedad Residencial â€¢ PÃ³liza #H-67890</p>
                  <div class="policy-meta">
                    <span class="badge badge-success">Activa</span>
                    <span>Vence: 20 Nov 2025</span>
                  </div>
                </div>
                <div class="policy-actions">
                  <button class="btn btn-sm btn-outline" onclick="viewPolicy('H-67890')">Ver Detalles</button>
                </div>
              </div>
              
              <div class="policy-item">
                <div class="policy-icon">â¤ï¸</div>
                <div class="policy-info">
                  <h4>Seguro de Vida</h4>
                  <p>Plan Familiar â€¢ PÃ³liza #V-24680</p>
                  <div class="policy-meta">
                    <span class="badge badge-success">Activa</span>
                    <span>Vence: 01 Ene 2026</span>
                  </div>
                </div>
                <div class="policy-actions">
                  <button class="btn btn-sm btn-outline" onclick="viewPolicy('V-24680')">Ver Detalles</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-header">
              <h3>Historial de Pagos</h3>
              <button class="btn btn-sm btn-outline" onclick="downloadPaymentHistory()">Descargar</button>
            </div>
            <div class="payments-table">
              <table>
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>PÃ³liza</th>
                    <th>Monto</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>15 Feb 2025</td>
                    <td>Auto - A-12345</td>
                    <td>$150.00</td>
                    <td><span class="badge badge-success">Pagado</span></td>
                  </tr>
                  <tr>
                    <td>20 Ene 2025</td>
                    <td>Hogar - H-67890</td>
                    <td>$200.00</td>
                    <td><span class="badge badge-success">Pagado</span></td>
                  </tr>
                  <tr>
                    <td>01 Ene 2025</td>
                    <td>Vida - V-24680</td>
                    <td>$100.00</td>
                    <td><span class="badge badge-success">Pagado</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <div class="dashboard-sidebar">
          <div class="dashboard-card">
            <h3>Acciones RÃ¡pidas</h3>
            <div class="quick-actions">
              <button class="btn btn-outline btn-block" onclick="makePayment()">
                ğŸ’³ Realizar Pago
              </button>
              <button class="btn btn-outline btn-block" onclick="fileClaim()">
                ğŸ“‹ Reportar Siniestro
              </button>
              <button class="btn btn-outline btn-block" onclick="updateInfo()">
                âœï¸ Actualizar InformaciÃ³n
              </button>
              <button class="btn btn-outline btn-block" onclick="contactAgent()">
                ğŸ“ Contactar Agente
              </button>
            </div>
          </div>
          
          <div class="dashboard-card">
            <h3>Mi Agente</h3>
            <div class="agent-info">
              <div class="agent-avatar">GK</div>
              <h4>Guillermo Krause</h4>
              <p>Agente Principal</p>
              <div class="agent-contact">
                <p>ğŸ“ +1 (234) 567-89</p>
                <p>ğŸ“§ gkrause@krauseins.com</p>
              </div>
              <button class="btn btn-sm btn-outline btn-block" onclick="contactAgent()">Contactar</button>
            </div>
          </div>
          
          <div class="dashboard-card">
            <h3>Documentos</h3>
            <div class="documents-list">
              <a href="#" class="document-link">
                ğŸ“„ PÃ³liza Auto (PDF)
              </a>
              <a href="#" class="document-link">
                ğŸ“„ PÃ³liza Hogar (PDF)
              </a>
              <a href="#" class="document-link">
                ğŸ“„ PÃ³liza Vida (PDF)
              </a>
              <a href="#" class="document-link">
                ğŸ“Š Estado de Cuenta
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
`;

// Agent Dashboard
pages['agent-dashboard'] = `
  <section class="dashboard-section agent-dashboard">
    <div class="dashboard-container">
      <div class="dashboard-header">
        <div>
          <h1>Panel de Agente</h1>
          <p>Bienvenido, ${currentUser?.name || 'Agente'}</p>
        </div>
        <button class="btn btn-outline" onclick="logout()">Cerrar SesiÃ³n</button>
      </div>
      
      <div class="dashboard-stats">
        <div class="dashboard-stat-card">
          <div class="stat-icon">ğŸ‘¥</div>
          <div class="stat-info">
            <div class="stat-value">142</div>
            <div class="stat-label">Clientes Activos</div>
          </div>
        </div>
        <div class="dashboard-stat-card">
          <div class="stat-icon">ğŸ“„</div>
          <div class="stat-info">
            <div class="stat-value">256</div>
            <div class="stat-label">PÃ³lizas Totales</div>
          </div>
        </div>
        <div class="dashboard-stat-card">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-info">
            <div class="stat-value">$85K</div>
            <div class="stat-label">Primas Este Mes</div>
          </div>
        </div>
        <div class="dashboard-stat-card">
          <div class="stat-icon">ğŸ“ˆ</div>
          <div class="stat-info">
            <div class="stat-value">+12%</div>
            <div class="stat-label">Crecimiento</div>
          </div>
        </div>
      </div>
      
      <div class="dashboard-grid">
        <div class="dashboard-main">
          <div class="dashboard-card">
            <div class="card-header">
              <h3>Clientes Recientes</h3>
              <button class="btn btn-sm btn-primary" onclick="addNewClient()">+ Nuevo Cliente</button>
            </div>
            <div class="clients-table">
              <table>
                <thead>
                  <tr>
                    <th>Cliente</th>
                    <th>PÃ³lizas</th>
                    <th>Estado</th>
                    <th>Ãšltima Actividad</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <div class="client-cell">
                        <div class="client-avatar">MG</div>
                        <div>
                          <div class="client-name">MarÃ­a GonzÃ¡lez</div>
                          <div class="client-email">maria.g@email.com</div>
                        </div>
                      </div>
                    </td>
                    <td>3 Activas</td>
                    <td><span class="badge badge-success">Al DÃ­a</span></td>
                    <td>Hace 2 dÃ­as</td>
                    <td>
                      <button class="btn-icon" onclick="viewClientDetails('MG')">ğŸ‘ï¸</button>
                      <button class="btn-icon" onclick="editClient('MG')">âœï¸</button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="client-cell">
                        <div class="client-avatar">CR</div>
                        <div>
                          <div class="client-name">Carlos RamÃ­rez</div>
                          <div class="client-email">carlos.r@email.com</div>
                        </div>
                      </div>
                    </td>
                    <td>2 Activas</td>
                    <td><span class="badge badge-success">Al DÃ­a</span></td>
                    <td>Hace 5 dÃ­as</td>
                    <td>
                      <button class="btn-icon" onclick="viewClientDetails('CR')">ğŸ‘ï¸</button>
                      <button class="btn-icon" onclick="editClient('CR')">âœï¸</button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="client-cell">
                        <div class="client-avatar">AM</div>
                        <div>
                          <div class="client-name">Ana MartÃ­nez</div>
                          <div class="client-email">ana.m@email.com</div>
                        </div>
                      </div>
                    </td>
                    <td>4 Activas</td>
                    <td><span class="badge badge-warning">Pago Pendiente</span></td>
                    <td>Hace 1 semana</td>
                    <td>
                      <button class="btn-icon" onclick="viewClientDetails('AM')">ğŸ‘ï¸</button>
                      <button class="btn-icon" onclick="editClient('AM')">âœï¸</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-header">
              <h3>Cotizaciones Pendientes</h3>
            </div>
            <div class="quotes-list">
              <div class="quote-item">
                <div class="quote-info">
                  <h4>Juan PÃ©rez - Seguro de Auto</h4>
                  <p>Toyota Corolla 2023</p>
                  <span class="quote-date">Solicitado: 28 Nov 2025</span>
                </div>
                <button class="btn btn-sm btn-primary" onclick="processQuote('Q-001')">Procesar</button>
              </div>
              <div class="quote-item">
                <div class="quote-info">
                  <h4>SofÃ­a LÃ³pez - Seguro de Hogar</h4>
                  <p>Casa 2 pisos, $350K</p>
                  <span class="quote-date">Solicitado: 27 Nov 2025</span>
                </div>
                <button class="btn btn-sm btn-primary" onclick="processQuote('Q-002')">Procesar</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="dashboard-sidebar">
          <div class="dashboard-card">
            <h3>Acciones RÃ¡pidas</h3>
            <div class="quick-actions">
              <button class="btn btn-primary btn-block" onclick="addNewClient()">
                ğŸ‘¥ Nuevo Cliente
              </button>
              <button class="btn btn-outline btn-block" onclick="createQuote()">
                ğŸ“ Nueva CotizaciÃ³n
              </button>
              <button class="btn btn-outline btn-block" onclick="processRenewal()">
                ğŸ”„ Renovaciones
              </button>
              <button class="btn btn-outline btn-block" onclick="viewReports()">
                ğŸ“Š Reportes
              </button>
            </div>
          </div>
          
          <div class="dashboard-card">
            <h3>Tareas Pendientes</h3>
            <div class="tasks-list">
              <div class="task-item">
                <input type="checkbox" onchange="completeTask(1)">
                <span>Seguimiento a MarÃ­a GonzÃ¡lez</span>
              </div>
              <div class="task-item">
                <input type="checkbox" onchange="completeTask(2)">
                <span>RenovaciÃ³n pÃ³liza Carlos R.</span>
              </div>
              <div class="task-item">
                <input type="checkbox" onchange="completeTask(3)">
                <span>Llamar a Ana MartÃ­nez (pago)</span>
              </div>
            </div>
          </div>
          
          <div class="dashboard-card">
            <h3>Comisiones</h3>
            <div class="commissions-info">
              <div class="commission-row">
                <span>Este Mes:</span>
                <strong>$3,250</strong>
              </div>
              <div class="commission-row">
                <span>Mes Anterior:</span>
                <strong>$2,890</strong>
              </div>
              <div class="commission-row">
                <span>AÃ±o a la Fecha:</span>
                <strong>$28,450</strong>
              </div>
              <button class="btn btn-sm btn-outline btn-block" onclick="viewCommissionDetails()">Ver Detalles</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
`;

// Load page function
function loadPage(page) {
    const mainContent = document.getElementById('mainContent');
    if (pages[page]) {
        mainContent.innerHTML = pages[page];

        // Initialize animations for stats and start sequence if on home page
        if (page === 'home') {
            setTimeout(() => {
                initStatsAnimation();
                startHomeSequence();
            }, 100);
        }
    } else {
        mainContent.innerHTML = '<div class="container"><h1>PÃ¡gina no encontrada</h1></div>';
    }
}

// Track all animation timeouts
const homeAnimationTimeouts = [];

function clearHomeAnimations() {
    homeAnimationTimeouts.forEach(timeout => clearTimeout(timeout));
    homeAnimationTimeouts.length = 0;
}

// Home animation sequence
function startHomeSequence() {
    const heroSection = document.querySelector('.hero-intro');
    const paradeSection = document.querySelector('.features-parade');
    const ctaSection = document.querySelector('.final-cta');
    const subNav = document.getElementById('sub-nav');
    const skipBtn = document.querySelector('.btn-home-start');
    const progressBar = document.querySelector('.progress-fill');

    if (!heroSection || !paradeSection || !ctaSection) return;

    // Clear any existing animations
    clearHomeAnimations();

    // Set initial gradient position
    document.body.classList.add('section-hero');

    // Show sub-nav bar but hide all buttons initially
    if (subNav) {
        subNav.classList.add('d-flex');
        subNav.classList.remove('d-none');
        const allButtons = subNav.querySelectorAll('.sub-nav-btn');
        allButtons.forEach(btn => {
            btn.classList.add('d-none');
            btn.classList.remove('d-inline-block');
        });
    }

    // Animate progress bar synchronized with sections (total: 18 seconds = 8 + 10)
    if (progressBar) {
        progressBar.style.width = '0%';
        progressBar.style.transition = 'width 8s linear';
        // Hero phase: 0% to 33% (8 seconds) - sync with hero button appearance
        setTimeout(() => progressBar.style.width = '33%', 100);
    }

    // Step 1: Show hero for 8 seconds (increased for more impact)
    homeAnimationTimeouts.push(setTimeout(() => {
        // Step 2: Transition to parade
        document.body.classList.remove('section-hero');
        document.body.classList.add('section-parade');
        heroSection.classList.add('fade-out-up');

        // Update progress bar: 33% to 66% during parade (sync with elecciÃ³n button)
        if (progressBar) {
            progressBar.style.transition = 'width 10s linear';
            setTimeout(() => progressBar.style.width = '66%', 100);
        }

        // Show Hero button with droplet effect after section starts minimizing
        homeAnimationTimeouts.push(setTimeout(() => {
            const heroBtn = subNav.querySelector('[data-section="hero"]');
            if (heroBtn) {
                heroBtn.classList.add('d-inline-block');
                heroBtn.classList.remove('d-none');
                heroBtn.classList.add('btn-droplet');
                homeAnimationTimeouts.push(setTimeout(() => heroBtn.classList.remove('btn-droplet'), 600));
            }
        }, 400));

        homeAnimationTimeouts.push(setTimeout(() => {
            heroSection.classList.remove('active');
            paradeSection.classList.add('active');

            // Step 3: After parade, show CTA
            homeAnimationTimeouts.push(setTimeout(() => {
                document.body.classList.remove('section-parade');
                document.body.classList.add('section-cta');
                paradeSection.classList.add('fade-out-up');

                // Show ElecciÃ³n button with droplet effect
                homeAnimationTimeouts.push(setTimeout(() => {
                    const eleccionBtn = subNav.querySelector('[data-section="eleccion"]');
                    if (eleccionBtn) {
                        eleccionBtn.classList.add('d-inline-block');
                        eleccionBtn.classList.remove('d-none');
                        eleccionBtn.classList.add('btn-droplet');
                        homeAnimationTimeouts.push(setTimeout(() => eleccionBtn.classList.remove('btn-droplet'), 600));
                    }
                }, 400));

                homeAnimationTimeouts.push(setTimeout(() => {
                    paradeSection.classList.remove('active');
                    ctaSection.classList.add('active');

                    // Update progress bar: 66% to 100% when CTA appears (sync with cotiza button)
                    if (progressBar) {
                        progressBar.style.transition = 'width 1s ease-out';
                        progressBar.style.width = '100%';
                    }

                    // Show Cotiza button with droplet effect
                    homeAnimationTimeouts.push(setTimeout(() => {
                        const cotizaBtn = subNav.querySelector('[data-section="cotiza"]');
                        if (cotizaBtn) {
                            cotizaBtn.classList.add('d-inline-block');
                            cotizaBtn.classList.remove('d-none');
                            cotizaBtn.classList.add('btn-droplet');
                            homeAnimationTimeouts.push(setTimeout(() => cotizaBtn.classList.remove('btn-droplet'), 600));
                        }
                    }, 400));

                    // Remove skip button
                    if (skipBtn) {
                        skipBtn.classList.add('d-none');
                        skipBtn.classList.remove('d-block');
                    }
                }, 800));
            }, 10000)); // Show parade for 10 seconds (increased for better engagement)
        }, 800));
    }, 8000)); // Show hero for 8 seconds
}

// Skip to final state
function skipToFinalState() {
    // CRITICAL: Cancel ALL pending animations first
    clearHomeAnimations();

    const heroSection = document.querySelector('.hero-intro');
    const paradeSection = document.querySelector('.features-parade');
    const ctaSection = document.querySelector('.final-cta');
    const subNav = document.getElementById('sub-nav');
    const skipBtn = document.querySelector('.btn-home-start');
    const progressBar = document.querySelector('.progress-fill');

    if (!heroSection || !paradeSection || !ctaSection) return;

    // Complete progress bar immediately
    if (progressBar) {
        progressBar.style.width = '100%';
    }

    // Update gradient position
    document.body.classList.remove('section-hero', 'section-parade');
    document.body.classList.add('section-cta');

    // CRITICAL: Remove active from ALL sections first to hide them
    const allSections = document.querySelectorAll('.home-section');
    allSections.forEach(section => {
        section.classList.remove('active');
        section.classList.remove('fade-out-up');
    });

    // Now show ONLY the CTA section
    ctaSection.classList.add('active');

    // Show sub-navigation with all buttons (using new timeouts that won't be cleared)
    if (subNav) {
        subNav.style.display = 'flex';
        const allButtons = subNav.querySelectorAll('.sub-nav-btn');
        allButtons.forEach((btn, index) => {
            btn.style.display = 'inline-block';
            setTimeout(() => {
                btn.classList.add('btn-droplet');
                setTimeout(() => btn.classList.remove('btn-droplet'), 600);
            }, index * 150);
        });
    }

    // Remove skip button
    if (skipBtn) {
        skipBtn.style.display = 'none';
    }
}

function showHomeSection(section) {
    // Update gradient position based on section
    document.body.classList.remove('section-hero', 'section-parade', 'section-cta');
    if (section === 'hero') {
        document.body.classList.add('section-hero');
    } else if (section === 'eleccion') {
        document.body.classList.add('section-parade');
    } else if (section === 'cotiza') {
        document.body.classList.add('section-cta');
    }

    // Update nav buttons
    document.querySelectorAll('.sub-nav-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.section === section) {
            btn.classList.add('active');
        }
    });

    // Hide ALL sections first (removes active class)
    const allSections = document.querySelectorAll('.home-section');
    allSections.forEach(sec => {
        sec.classList.remove('active');
        sec.classList.remove('fade-out-up');
    });

    // Show selected section
    const targetSection = document.getElementById(`${section}-section`);
    if (targetSection) {
        targetSection.classList.add('active');

        // Reinitialize stats if showing hero
        if (section === 'hero') {
            setTimeout(initStatsAnimation, 100);
        }
    }
}

// Toggle footer
function toggleFooter() {
    const footer = document.getElementById('footer');
    const toggleText = document.getElementById('footer-toggle-text');

    if (footer.classList.contains('collapsed')) {
        footer.classList.remove('collapsed');
        toggleText.textContent = 'Ocultar InformaciÃ³n';
    } else {
        footer.classList.add('collapsed');
        toggleText.textContent = 'Mostrar InformaciÃ³n';
    }
}

// Initialize stats animation
function initStatsAnimation() {
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach(stat => {
        const target = parseInt(stat.dataset.target);
        animateCounter(stat, target);
    });
}

// Animate counter
function animateCounter(element, target, duration = 2000) {
    const startTime = Date.now();

    function update() {
        const now = Date.now();
        const progress = Math.min((now - startTime) / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const currentValue = Math.floor(easeOut * target);

        element.textContent = currentValue;

        if (progress < 1) {
            requestAnimationFrame(update);
        } else {
            element.textContent = target;
        }
    }

    requestAnimationFrame(update);
}

// Form handlers
function handleContactSubmit(e) {
    e.preventDefault();
    showNotification('Mensaje enviado exitosamente. Te contactaremos pronto.', 'success');
    e.target.reset();
}

function handleClientLogin(e) {
    e.preventDefault();
    const email = e.target[0].value;
    const password = e.target[1].value;

    if (email === 'cliente@demo.com' && password === 'demo123') {
        currentUser = { name: 'Juan Cliente', type: 'client', email };
        localStorage.setItem('krause_user', JSON.stringify(currentUser));
        showNotification('Acceso concedido', 'success');

        // Redirect to loading screen with shield animation
        setTimeout(() => {
            window.location.href = 'loading.html?redirect=app.html%23dashboard';
        }, 500);
    } else {
        showNotification('Credenciales incorrectas', 'error');
    }
}

function handleAgentLogin(e) {
    e.preventDefault();
    const agentId = e.target[0].value;
    const password = e.target[1].value;

    if (agentId === 'agente@demo.com' && password === 'agent123') {
        currentUser = { name: 'Guillermo Krause', type: 'agent', id: agentId };
        localStorage.setItem('krause_user', JSON.stringify(currentUser));
        showNotification('Acceso concedido', 'success');

        // Redirect to loading screen with shield animation
        setTimeout(() => {
            window.location.href = 'loading.html?redirect=app.html%23agent-dashboard';
        }, 500);
    } else {
        showNotification('Credenciales incorrectas', 'error');
    }
}

// Dashboard functions (placeholders)
function viewPolicy(policyId) {
    showNotification(`Mostrando detalles de pÃ³liza ${policyId}`, 'info');
}

function makePayment() {
    showNotification('Redirigiendo a pasarela de pago...', 'info');
}

function fileClaim() {
    showNotification('Abriendo formulario de siniestros...', 'info');
}

function updateInfo() {
    showNotification('Abriendo formulario de actualizaciÃ³n...', 'info');
}

function contactAgent() {
    // Allow opening the contact page only when triggered by an agent action
    window.__allowContact = true;
    showNotification('Abriendo chat con agente...', 'info');
    navigateTo('contact');
    setTimeout(() => { window.__allowContact = false; }, 500);
}

function downloadPaymentHistory() {
    showNotification('Descargando historial...', 'info');
}

function openQuoteModal(type) {
    showNotification(`Abriendo cotizaciÃ³n para seguro de ${type}`, 'info');
}

function addNewClient() {
    showNotification('Abriendo formulario de nuevo cliente...', 'info');
}

function viewClientDetails(clientId) {
    showNotification(`Mostrando detalles del cliente ${clientId}`, 'info');
}

function editClient(clientId) {
    showNotification(`Editando cliente ${clientId}`, 'info');
}

function processQuote(quoteId) {
    showNotification(`Procesando cotizaciÃ³n ${quoteId}`, 'info');
}

function createQuote() {
    showNotification('Creando nueva cotizaciÃ³n...', 'info');
}

function processRenewal() {
    showNotification('Abriendo renovaciones pendientes...', 'info');
}

function viewReports() {
    showNotification('Generando reportes...', 'info');
}

function completeTask(taskId) {
    showNotification('Tarea completada', 'success');
}

function viewCommissionDetails() {
    showNotification('Mostrando detalle de comisiones...', 'info');
}

function showAgentRegistration() {
    showNotification('Contacta al administrador para solicitar acceso como agente', 'info');
}

// Particles animation (same as landing)
const canvas = document.getElementById('particles-canvas');
const ctx = canvas.getContext('2d');
let particles = [];

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

resizeCanvas();
window.addEventListener('resize', resizeCanvas);

class Particle {
    constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 4 + 2;
        this.speedX = Math.random() * 0.5 - 0.25;
        this.speedY = Math.random() * 0.5 - 0.25;
        this.opacity = Math.random() * 0.4 + 0.4;
    }

    checkCollisionWithElements() {
        // Verificar colisiÃ³n con elementos del DOM que tengan contenido
        const elements = document.querySelectorAll('.navbar, .sub-navigation, .main-content, .home-section, .feature-box, .agent-card, .stat-box, .btn, .auth-card, .dashboard-card, .service-card-detailed, .cta-section');

        for (let elem of elements) {
            const rect = elem.getBoundingClientRect();
            const padding = 20; // Margen de seguridad alrededor del elemento

            // Verificar si la partÃ­cula estÃ¡ dentro o cerca del elemento
            if (this.x > rect.left - padding &&
                this.x < rect.right + padding &&
                this.y > rect.top - padding &&
                this.y < rect.bottom + padding) {

                // Rebotar en la direcciÃ³n opuesta
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                // Calcular direcciÃ³n de rebote basada en la posiciÃ³n relativa
                if (this.x < centerX) {
                    this.speedX = -Math.abs(this.speedX);
                } else {
                    this.speedX = Math.abs(this.speedX);
                }

                if (this.y < centerY) {
                    this.speedY = -Math.abs(this.speedY);
                } else {
                    this.speedY = Math.abs(this.speedY);
                }

                return true;
            }
        }
        return false;
    }

    update() {
        this.x += this.speedX;
        this.y += this.speedY;

        // Rebotar en los bordes del canvas
        if (this.x > canvas.width) {
            this.x = canvas.width;
            this.speedX *= -1;
        }
        if (this.x < 0) {
            this.x = 0;
            this.speedX *= -1;
        }
        if (this.y > canvas.height) {
            this.y = canvas.height;
            this.speedY *= -1;
        }
        if (this.y < 0) {
            this.y = 0;
            this.speedY *= -1;
        }

        // Verificar colisiones con elementos del DOM
        this.checkCollisionWithElements();
    }

    draw() {
        ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
    }
}

function initParticles() {
    particles = [];
    const particleCount = Math.min(100, Math.floor((canvas.width * canvas.height) / 10000));
    for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle());
    }
}

function connectParticles() {
    for (let i = 0; i < particles.length; i++) {
        for (let j = i + 1; j < particles.length; j++) {
            const dx = particles[i].x - particles[j].x;
            const dy = particles[i].y - particles[j].y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 120) {
                ctx.strokeStyle = `rgba(255, 255, 255, ${0.15 * (1 - distance / 120)})`;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(particles[i].x, particles[i].y);
                ctx.lineTo(particles[j].x, particles[j].y);
                ctx.stroke();
            }
        }
    }
}

function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(particle => {
        particle.update();
        particle.draw();
    });
    connectParticles();
    requestAnimationFrame(animateParticles);
}

// Legacy inline particles initialization disabled â€” use the centralized particles module
// initParticles();
// animateParticles();

// Initialize app
document.addEventListener('DOMContentLoaded', () => {
    // Check for hash navigation
    const hash = window.location.hash.substring(1);

    if (checkAuth()) {
        if (currentUser.type === 'client') {
            navigateTo('dashboard');
        } else if (currentUser.type === 'agent') {
            navigateTo('agent-dashboard');
        } else {
            navigateTo('home');
        }
    } else {
        // Navigate based on hash if present
        if (hash === 'login') {
            navigateTo('login');
        } else if (hash === 'agent-login') {
            navigateTo('agent-login');
        } else {
            navigateTo('home');
        }
    }
});

console.log('ğŸ›ï¸ Krause Insurance App cargada correctamente');
