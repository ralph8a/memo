/*! For license information please see 369.krause.app.js.LICENSE.txt */
"use strict";(self.webpackChunkreact_app=self.webpackChunkreact_app||[]).push([[369],{369:(n,e,t)=>{t.r(e),t.d(e,{AgentDashboardManager:()=>f,AgentPaymentSchedulePanel:()=>v,AgentPoliciesPanel:()=>h});var i=t(753);function a(n){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},a(n)}function o(){var n,e,t="function"==typeof Symbol?Symbol:{},i=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function c(t,i,a,o){var c=i&&i.prototype instanceof s?i:s,d=Object.create(c.prototype);return r(d,"_invoke",function(t,i,a){var o,r,c,s=0,d=a||[],u=!1,p={p:0,n:0,v:n,a:v,f:v.bind(n,4),d:function(e,t){return o=e,r=0,c=n,p.n=t,l}};function v(t,i){for(r=t,c=i,e=0;!u&&s&&!a&&e<d.length;e++){var a,o=d[e],v=p.p,h=o[2];t>3?(a=h===i)&&(c=o[(r=o[4])?5:(r=3,3)],o[4]=o[5]=n):o[0]<=v&&((a=t<2&&v<o[1])?(r=0,p.v=i,p.n=o[1]):v<h&&(a=t<3||o[0]>i||i>h)&&(o[4]=t,o[5]=i,p.n=h,r=0))}if(a||t>1)return l;throw u=!0,i}return function(a,d,h){if(s>1)throw TypeError("Generator is already running");for(u&&1===d&&v(d,h),r=d,c=h;(e=r<2?n:c)||!u;){o||(r?r<3?(r>1&&(p.n=-1),v(r,c)):p.n=c:p.v=c);try{if(s=2,o){if(r||(a="next"),e=o[a]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,r<2&&(r=0)}else 1===r&&(e=o.return)&&e.call(o),r<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),r=1);o=n}else if((e=(u=p.n<0)?c:t.call(i,p))!==l)break}catch(e){o=n,r=1,c=e}finally{s=1}}return{value:e,done:u}}}(t,a,o),!0),d}var l={};function s(){}function d(){}function u(){}e=Object.getPrototypeOf;var p=[][i]?e(e([][i]())):(r(e={},i,function(){return this}),e),v=u.prototype=s.prototype=Object.create(p);function h(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,u):(n.__proto__=u,r(n,a,"GeneratorFunction")),n.prototype=Object.create(v),n}return d.prototype=u,r(v,"constructor",u),r(u,"constructor",d),d.displayName="GeneratorFunction",r(u,a,"GeneratorFunction"),r(v),r(v,a,"Generator"),r(v,i,function(){return this}),r(v,"toString",function(){return"[object Generator]"}),(o=function(){return{w:c,m:h}})()}function r(n,e,t,i){var a=Object.defineProperty;try{a({},"",{})}catch(n){a=0}r=function(n,e,t,i){function o(e,t){r(n,e,function(n){return this._invoke(e,t,n)})}e?a?a(n,e,{value:t,enumerable:!i,configurable:!i,writable:!i}):n[e]=t:(o("next",0),o("throw",1),o("return",2))},r(n,e,t,i)}function c(n,e,t,i,a,o,r){try{var c=n[o](r),l=c.value}catch(n){return void t(n)}c.done?e(l):Promise.resolve(l).then(i,a)}function l(n){return function(){var e=this,t=arguments;return new Promise(function(i,a){var o=n.apply(e,t);function r(n){c(o,i,a,r,l,"next",n)}function l(n){c(o,i,a,r,l,"throw",n)}r(void 0)})}}function s(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function d(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,p(i.key),i)}}function u(n,e,t){return e&&d(n.prototype,e),t&&d(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function p(n){var e=function(n){if("object"!=a(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var t=e.call(n,"string");if("object"!=a(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==a(e)?e:e+""}var v=function(){return u(function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,n),this.container=document.getElementById(e),this.filteredClientId=t.clientId||null,this.viewMode=t.viewMode||"all"},[{key:"render",value:(n=l(o().m(function n(){var e,t,a,r=this;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:if(this.container){n.n=1;break}return console.warn("Agent payment schedule container not found"),n.a(2);case 1:return n.p=1,n.n=2,i.apiService.request("?action=agent_payments",{method:"GET"});case 2:e=n.v,t=e.payments||e||[],this.filteredClientId&&(t=t.filter(function(n){return n.client_id===r.filteredClientId})),"pending"===this.viewMode?t=t.filter(function(n){return"pending"===n.status}):"overdue"===this.viewMode&&(t=t.filter(function(n){return"overdue"===n.status})),this.container.innerHTML='\n                <div class="agent-payment-panel">\n                    <div class="panel-header">\n                        <h3>\n                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <rect x="2" y="5" width="20" height="14" rx="2" />\n                                <line x1="2" y1="10" x2="22" y2="10" />\n                            </svg>\n                            Calendario de Pagos '.concat(this.filteredClientId?"- Cliente Filtrado":"",'\n                        </h3>\n                        <div class="panel-filters">\n                            <button class="filter-btn ').concat("all"===this.viewMode?"active":"",'" \n                                    onclick="window.agentDashboard?.setPaymentView(\'all\')">\n                                Todos (').concat(t.length,')\n                            </button>\n                            <button class="filter-btn ').concat("pending"===this.viewMode?"active":"",'" \n                                    onclick="window.agentDashboard?.setPaymentView(\'pending\')">\n                                Pendientes (').concat(t.filter(function(n){return"pending"===n.status}).length,')\n                            </button>\n                            <button class="filter-btn ').concat("overdue"===this.viewMode?"active":"",'" \n                                    onclick="window.agentDashboard?.setPaymentView(\'overdue\')">\n                                Vencidos (').concat(t.filter(function(n){return"overdue"===n.status}).length,')\n                            </button>\n                        </div>\n                    </div>\n                    <div class="panel-body">\n                        ').concat(t.length>0?'\n                            <div class="payment-table modern-table">\n                                <table>\n                                    <thead>\n                                        <tr>\n                                            <th>Cliente</th>\n                                            <th>P贸liza</th>\n                                            <th>Monto</th>\n                                            <th>Vence</th>\n                                            <th>Estado</th>\n                                            <th></th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        '.concat(t.map(function(n){return r.renderPaymentRow(n)}).join(""),"\n                                    </tbody>\n                                </table>\n                            </div>\n                        "):'\n                            <div class="empty-state">\n                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">\n                                    <rect x="2" y="5" width="20" height="14" rx="2" />\n                                    <line x1="2" y1="10" x2="22" y2="10" />\n                                </svg>\n                                <p>No hay pagos '.concat("all"!==this.viewMode?"pending"===this.viewMode?"pendientes":"vencidos":"","</p>\n                            </div>\n                        "),"\n                    </div>\n                </div>\n            "),n.n=4;break;case 3:n.p=3,a=n.v,console.error("Error rendering agent payments:",a),this.container.innerHTML='\n                <div class="error-state">\n                    <p>Error al cargar pagos: '.concat(a.message,"</p>\n                </div>\n            ");case 4:return n.a(2)}},n,this,[[1,3]])})),function(){return n.apply(this,arguments)})},{key:"renderPaymentRow",value:function(n){var e,t=this.getStatusClass(n.status),i=Math.ceil((new Date(n.due_date)-new Date)/864e5),a=i<0?"urgent":i<=3?"warning":"",o=(null===(e=n.client_name)||void 0===e?void 0:e.split(" ").slice(0,2).join(" "))||"N/A";return'\n            <tr class="'.concat(a,'">\n                <td>\n                    <div class="client-info">\n                        <strong>').concat(o,'</strong>\n                    </div>\n                </td>\n                <td><span class="policy-num">').concat(n.policy_number,'</span></td>\n                <td class="amount">$').concat(parseFloat(n.amount).toFixed(2),'</td>\n                <td>\n                    <div class="due-date ').concat(a,'">\n                        ').concat(this.formatShortDate(n.due_date),"\n                        ").concat(i<0?'<small class="text-danger">-'.concat(Math.abs(i),"d</small>"):i<=3?'<small class="text-warning">'.concat(i,"d</small>"):"",'\n                    </div>\n                </td>\n                <td><span class="status-badge ').concat(t,'">').concat(this.getStatusText(n.status),'</span></td>\n                <td>\n                    <div class="action-buttons">                        <button class="btn-icon" title="Ver detalles" onclick="window.agentDashboard?.reviewProof(\'').concat(n.proof_id,'\')">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>\n                                <circle cx="12" cy="12" r="3"/>\n                            </svg>\n                        </button>\n                        <button class="btn-icon" title="Ver detalles" \n                                onclick="window.appHandlers?.viewClientDetails?.(\'').concat(n.client_id,'\')">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>\n                                <circle cx="12" cy="12" r="3"/>\n                            </svg>\n                        </button>\n                        ').concat(n.proof_id?'\n                            <button class="btn-icon" title="Revisar comprobante"\n                                    onclick="window.agentDashboard?.reviewProof(\''.concat(n.proof_id,'\')">\n                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>\n                                    <polyline points="14 2 14 8 20 8"/>\n                                </svg>\n                            </button>\n                        '):"",'\n                        <button class="btn-icon" title="Contactar cliente"\n                                onclick="window.agentDashboard?.contactClient(\'').concat(n.client_id,'\')">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>\n                            </svg>\n                        </button>\n                    </div>\n                </td>\n            </tr>\n        ')}},{key:"getStatusClass",value:function(n){return{paid:"success",pending:"warning",overdue:"danger",cancelled:"neutral"}[n]||"neutral"}},{key:"getStatusText",value:function(n){return{paid:"Pagado",pending:"Pendiente",overdue:"Vencido",cancelled:"Cancelado"}[n]||n}},{key:"formatDate",value:function(n){return new Date(n).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})}},{key:"formatShortDate",value:function(n){return new Date(n).toLocaleDateString("es-ES",{day:"numeric",month:"short"})}}]);var n}(),h=function(){return u(function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,n),this.container=document.getElementById(e),this.filteredClientId=t.clientId||null,this.viewMode=t.viewMode||"all"},[{key:"render",value:(n=l(o().m(function n(){var e,i,a,r,c,l,s,d,u=this;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:if(this.container){n.n=1;break}return console.warn("Agent policies container not found"),n.a(2);case 1:return n.p=1,n.n=2,Promise.resolve().then(t.bind(t,753));case 2:return i=n.v,a=i.apiService,n.n=3,a.request("?action=agent_dashboard",{method:"GET"});case 3:r=n.v,c=(null===(e=r.clients)||void 0===e?void 0:e.flatMap(function(n){return n.policies||[]}))||[],this.filteredClientId&&(c=c.filter(function(n){return n.client_id===u.filteredClientId})),"active"===this.viewMode?c=c.filter(function(n){return"active"===n.status}):"expiring"===this.viewMode&&(l=new Date,s=new Date(l.getTime()+2592e6),c=c.filter(function(n){var e=new Date(n.renewal_date);return e<=s&&e>l})),this.container.innerHTML='\n                <div class="agent-policies-panel">\n                    <div class="panel-header">\n                        <h3>\n                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>\n                                <polyline points="14 2 14 8 20 8"/>\n                            </svg>\n                            P贸lizas '.concat(this.filteredClientId?"- Cliente Filtrado":"",'\n                        </h3>\n                        <div class="panel-filters">\n                            <button class="filter-btn ').concat("all"===this.viewMode?"active":"",'" \n                                    onclick="window.agentDashboard?.setPoliciesView(\'all\')">\n                                Todas (').concat(c.length,')\n                            </button>\n                            <button class="filter-btn ').concat("active"===this.viewMode?"active":"",'" \n                                    onclick="window.agentDashboard?.setPoliciesView(\'active\')">\n                                Activas (').concat(c.filter(function(n){return"active"===n.status}).length,')\n                            </button>\n                            <button class="filter-btn ').concat("expiring"===this.viewMode?"active":"",'" \n                                    onclick="window.agentDashboard?.setPoliciesView(\'expiring\')">\n                                Por vencer (').concat(this.getExpiringCount(c),')\n                            </button>\n                        </div>\n                    </div>\n                    <div class="panel-body">\n                        ').concat(c.length>0?'\n                            <div class="policies-grid">\n                                '.concat(c.map(function(n){return u.renderPolicyCard(n)}).join(""),"\n                            </div>\n                        "):'\n                            <div class="empty-state">\n                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">\n                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>\n                                    <polyline points="14 2 14 8 20 8"/>\n                                </svg>\n                                <p>No hay p贸lizas</p>\n                            </div>\n                        ',"\n                    </div>\n                </div>\n            "),n.n=5;break;case 4:n.p=4,d=n.v,console.error("Error rendering agent policies:",d),this.container.innerHTML='\n                <div class="error-state">\n                    <p>Error al cargar p贸lizas: '.concat(d.message,"</p>\n                </div>\n            ");case 5:return n.a(2)}},n,this,[[1,4]])})),function(){return n.apply(this,arguments)})},{key:"renderPolicyCard",value:function(n){var e="active"===n.status?"success":"expired"===n.status?"danger":"neutral",t=Math.ceil((new Date(n.renewal_date)-new Date)/864e5);return'\n            <div class="policy-card '.concat(e,'">\n                <div class="policy-header">\n                    <span class="policy-type">').concat(this.getPolicyTypeLabel(n.policy_type),'</span>\n                    <span class="policy-status ').concat(e,'">').concat(n.status,'</span>\n                </div>\n                <div class="policy-body">\n                    <h4>').concat(n.policy_number,'</h4>\n                    <p class="client-name">').concat(n.client_name||"Cliente N/A",'</p>\n                    <div class="policy-details">\n                        <div class="detail-item">\n                            <span class="label">Prima:</span>\n                            <span class="value">$').concat(parseFloat(n.premium_amount).toFixed(2),'/mes</span>\n                        </div>\n                        <div class="detail-item">\n                            <span class="label">Cobertura:</span>\n                            <span class="value">$').concat(parseFloat(n.coverage_amount).toLocaleString(),'</span>\n                        </div>\n                        <div class="detail-item">\n                            <span class="label">Renovaci贸n:</span>\n                            <span class="value ').concat(t<=30?"warning":"",'">\n                                ').concat(this.formatDate(n.renewal_date),"\n                                ").concat(t<=30&&t>0?" (".concat(t," d铆as)"):"",'\n                            </span>\n                        </div>\n                    </div>\n                </div>\n                <div class="policy-footer">\n                    <button class="btn btn-sm btn-outline" \n                            onclick="window.appHandlers?.viewPolicy?.(\'').concat(n.id,'\')">\n                        Ver detalles\n                    </button>\n                    <button class="btn btn-sm btn-primary" \n                            onclick="window.appHandlers?.viewClientDetails?.(\'').concat(n.client_id,"')\">\n                        Ver cliente\n                    </button>\n                </div>\n            </div>\n        ")}},{key:"getPolicyTypeLabel",value:function(n){return{auto:" Auto",home:" Hogar",life:"わ Vida",health:" Salud",business:" Negocio"}[n]||n}},{key:"getExpiringCount",value:function(n){var e=new Date,t=new Date(e.getTime()+2592e6);return n.filter(function(n){var i=new Date(n.renewal_date);return i<=t&&i>e}).length}},{key:"formatDate",value:function(n){return new Date(n).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})}}]);var n}(),f=function(){return u(function n(){s(this,n),this.filteredClientId=null,this.paymentPanel=null,this.policiesPanel=null,this.paymentViewMode="all",this.policiesViewMode="all"},[{key:"initialize",value:(e=l(o().m(function n(){return o().w(function(n){for(;;)switch(n.n){case 0:return this.paymentPanel=new v("agent-payments-container",{clientId:this.filteredClientId,viewMode:this.paymentViewMode}),this.policiesPanel=new h("agent-policies-container",{clientId:this.filteredClientId,viewMode:this.policiesViewMode}),n.n=1,this.render();case 1:return n.a(2)}},n,this)})),function(){return e.apply(this,arguments)})},{key:"render",value:(n=l(o().m(function n(){return o().w(function(n){for(;;)switch(n.n){case 0:if(!this.paymentPanel){n.n=1;break}return n.n=1,this.paymentPanel.render();case 1:if(!this.policiesPanel){n.n=2;break}return n.n=2,this.policiesPanel.render();case 2:return n.a(2)}},n,this)})),function(){return n.apply(this,arguments)})},{key:"setClientFilter",value:function(n){this.filteredClientId=n,this.paymentPanel&&(this.paymentPanel.filteredClientId=n),this.policiesPanel&&(this.policiesPanel.filteredClientId=n),this.render(),this.updateFilterUI(n)}},{key:"clearClientFilter",value:function(){this.setClientFilter(null)}},{key:"setPaymentView",value:function(n){this.paymentViewMode=n,this.paymentPanel&&(this.paymentPanel.viewMode=n,this.paymentPanel.render())}},{key:"setPoliciesView",value:function(n){this.policiesViewMode=n,this.policiesPanel&&(this.policiesPanel.viewMode=n,this.policiesPanel.render())}},{key:"updateFilterUI",value:function(n){var e=document.getElementById("client-filter-indicator");e&&(n?(e.textContent="Filtrando por cliente: ".concat(n),e.style.display="block"):e.style.display="none")}},{key:"reviewProof",value:function(n){var e;console.log("Reviewing proof:",n),null!==(e=window.appHandlers)&&void 0!==e&&e.reviewPaymentProof&&window.appHandlers.reviewPaymentProof(n)}},{key:"contactClient",value:function(n){var e;console.log("Contacting client:",n),null!==(e=window.appHandlers)&&void 0!==e&&e.contactClient&&window.appHandlers.contactClient(n)}}]);var n,e}();"undefined"!=typeof window&&window.addEventListener("DOMContentLoaded",function(){(document.getElementById("agent-payments-container")||document.getElementById("agent-policies-container"))&&(window.agentDashboard=new f,window.agentDashboard.initialize())})}}]);
//# sourceMappingURL=369.krause.app.js.map