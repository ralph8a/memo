<section class="dashboard-section agent-dashboard" id="agent-dashboard-section">
  
  <!-- Hero Header - Componente independiente -->
  <div class="dashboard-hero-container">
    <div class="hero-surface">
      <header class="dashboard-top-header search-hero hero-grid">
        <div class="hero-copy">
          <div class="hero-title-row">
            <span class="eyebrow">Portal de agentes</span>
            <span class="hero-divider" aria-hidden="true">|</span>
            <span class="hero-welcome">Bienvenido <span data-agent-name>Guillermo Krause S.</span></span>
          </div>
        </div>
        <div class="hero-search">
          <div class="search-bar stretch">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="7" />
              <line x1="16.65" y1="16.65" x2="21" y2="21" />
            </svg>
            <input type="search" placeholder="Buscar clientes, p√≥lizas o cotizaciones" aria-label="Buscar" />
          </div>
          <div class="header-actions tight pill-actions">
            <button class="icon-pill" aria-label="Notificaciones" onclick="window.appHandlers?.openNotifications?.()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 8a6 6 0 1 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" />
                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
              </svg>
              <span class="dot"></span>
            </button>
            <button class="icon-pill" aria-label="Contactar cliente" onclick="window.contactModal?.open()" title="Contactar cliente">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </button>
            <button class="icon-pill" aria-label="Direct Messages" onclick="window.directMessages?.openModal()" title="Mensajes directos">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
              </svg>
              <span class="badge-count" data-dm-badge style="display: none;">0</span>
            </button>
            <span class="badge badge-accent ghost" onclick="window.directMessages?.openModal()" style="cursor: pointer;" title="Mensajes directos">
              Direct
              <span class="badge-count" data-dm-badge style="display: none; margin-left: 4px;">0</span>
            </span>
          </div>
        </div>
      </header>
    </div>
  </div>

  <div class="dashboard-layout">
    <aside class="dashboard-sidebar">
      <div class="sidebar-surface">
        <div class="sidebar-stack">
          <div class="content-card compact sidebar-block sidebar-brand-block">
            <div class="sidebar-header sidebar-branding">
              <div class="logo-slot logo-slot-nav" data-render-logo data-logo-size="sm" data-logo-contrast="primary" data-logo-class="logo-shield" aria-label="Krause Insurance" onclick="window.toggleTheme()" style="cursor: pointer;">
                <svg class="krause-shield logo-shield logo-size-sm" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                  <ellipse class="shield-circle" cx="40" cy="38" rx="22" ry="22" stroke="currentColor" stroke-width="3" fill="none" />
                  <path class="shield-diamond" d="M40 12 L62 35 L40 70 L18 35 Z" stroke="currentColor" stroke-width="3" fill="none" />
                  <path class="shield-arc" d="M24 50 Q40 30 56 50" stroke="currentColor" stroke-width="3" fill="none" />
                  <line class="shield-line" x1="40" y1="50" x2="40" y2="68" stroke="currentColor" stroke-width="3" />
                  <circle class="shield-center" cx="40" cy="40" r="6" fill="currentColor" />
                </svg>
              </div>
              <div class="brand-text brand-text-sidebar">
                <span class="brand-name">Krause</span>
                <span class="brand-tagline">Insurance</span>
              </div>
            </div>
          </div>

          <div class="content-card compact sidebar-block">
            <div class="sidebar-widget-group">
              <div class="sidebar-qa-header">Clientes recientes</div>
              <div class="recent-clients-pills">
                <div style="padding: 12px; text-align: center; color: var(--theme-text-secondary); font-size: 0.875rem;">
                  Cargando clientes...
                </div>
              </div>
            </div>
          </div>

          <div class="content-card compact sidebar-block">
            <div class="sidebar-widget-group">
              <div class="sidebar-qa-header">Gesti√≥n r√°pida</div>
              <div class="widget-mini-list">
                <button class="widget-mini-item" onclick="window.appHandlers?.openForms?.()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11H3v10h6V11zM21 11h-6v10h6V11zM15 3H9v6h6V3z"/>
                  </svg>
                  <span>Cuestionarios</span>
                  <span class="widget-mini-badge">3</span>
                </button>
                <button class="widget-mini-item" onclick="window.appHandlers?.openQuotes?.()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="9" y1="9" x2="15" y2="9"/>
                    <line x1="9" y1="13" x2="15" y2="13"/>
                  </svg>
                  <span>Documentos</span>
                  <span class="widget-mini-badge">12</span>
                </button>
                <button class="widget-mini-item" onclick="window.appHandlers?.openContacts?.()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                  <span>Contactos</span>
                  <span class="widget-mini-badge">48</span>
                </button>
              </div>
            </div>
          </div>

          <div class="content-card compact sidebar-block">
            <div class="sidebar-quick-actions">
              <div class="sidebar-qa-header">Acciones r√°pidas</div>
              <button class="qa-btn" onclick="window.dashboardActions?.createQuote?.()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Nueva cotizaci√≥n
              </button>
              <button class="qa-btn" onclick="window.dashboardActions?.addClient?.()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"/>
                  <path d="M4 21v-1a7 7 0 0 1 14 0v1"/>
                </svg>
                Agregar cliente
              </button>
              <button class="qa-btn" onclick="window.dashboardActions?.scheduleAppointment?.()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Agendar cita
              </button>
              <button class="qa-btn" onclick="window.dashboardActions?.uploadPolicyDocument?.()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Cargar p√≥liza
              </button>
            </div>
          </div>

          <div class="content-card compact sidebar-block sidebar-logout-block"
            <button class="sidebar-logout" onclick="window.logout?.()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
              </svg>
              Salir
            </button>
          </div>
        </div><!-- .sidebar-stack -->
      </div><!-- .sidebar-surface -->
    </aside>

    <div class="dashboard-main-wrapper">
      <div class="dashboard-stage">
        <div class="stage-main">

          <div class="dashboard-tabs" id="agent-tabs" role="tablist" aria-label="Navegaci√≥n del dashboard de agentes" style="display: none;">
            <button class="dashboard-tab active" data-target="agent-overview" aria-pressed="true">Resumen</button>
          </div>

          <div class="tab-panels" id="agent-panels">
            <div class="tab-panel active" id="agent-overview" role="tabpanel" aria-label="Resumen">
              <div class="mimic-wrap">
                <div class="stats-grid compact">
                  <div class="stat-card stat-primary">
                    <div class="stat-icon-wrapper">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"/>
                        <path d="M4 21v-1a7 7 0 0 1 14 0v1"/>
                      </svg>
                    </div>
                    <div class="stat-content">
                      <div class="stat-value">89</div>
                      <div class="stat-label">Total Clientes</div>
                    </div>
                    <div class="stat-trend positive">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                        <polyline points="17 6 23 6 23 12"/>
                      </svg>
                      <span>+15.8%</span>
                    </div>
                  </div>

                  <div class="stat-card stat-success">
                    <div class="stat-icon-wrapper">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                      </svg>
                    </div>
                    <div class="stat-content">
                      <div class="stat-value">156</div>
                      <div class="stat-label">P√≥lizas Activas</div>
                    </div>
                    <div class="stat-badge success">+18 mes</div>
                  </div>

                  <div class="stat-card stat-warning">
                    <div class="stat-icon-wrapper">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                      </svg>
                    </div>
                    <div class="stat-content">
                      <div class="stat-value">$45.3K</div>
                      <div class="stat-label">Comisiones Mes</div>
                    </div>
                    <div class="stat-trend positive">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                        <polyline points="17 6 23 6 23 12"/>
                      </svg>
                      <span>+12.4%</span>
                    </div>
                  </div>

                  <div class="stat-card stat-info">
                    <div class="stat-icon-wrapper">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                      </svg>
                    </div>
                    <div class="stat-content">
                      <div class="stat-value">73%</div>
                      <div class="stat-label">Tasa de Cierre</div>
                    </div>
                    <div class="stat-badge info">Excelente</div>
                  </div>
                </div>
              </div>

              <div class="dashboard-body">
                <div class="main-surface mimic-wrap">
                  <div class="mimic-wrap-inner">
                    <div class="mimic-col main">
                      
                      <!-- Panel de Cargar P√≥liza removido - ahora es bot√≥n de acci√≥n r√°pida -->

                      <!-- Client Filter Panel -->
                      <div id="client-filter-panel" class="content-card compact" style="display: none;">
                        <div class="card-header-modern">
                          <div style="display: flex; align-items: center; gap: 8px;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/>
                            </svg>
                            <h3>Filtro Activo</h3>
                          </div>
                          <button class="btn btn-sm btn-outline" onclick="window.agentDashboard?.clearClientFilter()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <line x1="18" y1="6" x2="6" y2="18"/>
                              <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                            Limpiar filtro
                          </button>
                        </div>
                        <div class="card-body" style="padding: 16px 20px;">
                          <div id="client-filter-indicator" class="filter-active-info">
                            <div class="filter-icon">
                              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                              </svg>
                            </div>
                            <div class="filter-text">
                              <div class="filter-label">Cliente seleccionado:</div>
                              <div class="filter-value" data-filter-client-name>Cargando...</div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Agent Payment Schedule Panel -->
                      <div class="content-card list-card compact" id="agent-payments-section">
                        <div class="card-header-modern">
                          <h3>üìÖ Calendario de Pagos</h3>
                          <button class="btn btn-sm btn-outline" onclick="window.appHandlers?.viewPaymentHistory?.()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                              <polyline points="14 2 14 8 20 8"/>
                              <line x1="12" y1="18" x2="12" y2="12"/>
                              <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                            Ver comprobantes
                          </button>
                        </div>
                        <div id="agent-payments-container">
                          <p class="loading-state">Cargando calendario de pagos...</p>
                        </div>
                      </div>

                      <!-- Agent Policies Panel -->
                      <div class="content-card list-card compact" id="agent-policies-section">
                        <div id="agent-policies-container">
                          <p class="loading-state">Cargando p√≥lizas...</p>
                        </div>
                      </div>

                      <!-- Payment Proof Review Section -->
                      <div class="content-card compact">
                        <div class="card-header-modern">
                          <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                              <rect x="2" y="5" width="20" height="14" rx="2" />
                              <line x1="2" y1="10" x2="22" y2="10" />
                              <line x1="7" y1="15" x2="10" y2="15" />
                            </svg>
                            Comprobantes Pendientes
                          </h3>
                          <span class="card-badge" id="proof-count-badge">0</span>
                        </div>
                        <div id="proof-review-container" data-proof-review>
                          <p class="loading-state">Cargando comprobantes pendientes...</p>
                        </div>
                      </div>

                      <div class="content-card compact">
                        <div class="card-header-modern">
                          <h3>Roadmap de Suscripci√≥n</h3>
                          <div class="roadmap-tabs" role="tablist">
                            <button class="roadmap-tab active" data-client="MG" aria-pressed="true">Mar√≠a G.</button>
                            <button class="roadmap-tab" data-client="CR" aria-pressed="false">Carlos R.</button>
                            <button class="roadmap-tab" data-client="AM" aria-pressed="false">Ana M.</button>
                          </div>
                        </div>
                        <div class="roadmap-body">
                          <div class="roadmap-status" data-client="MG">
                            <div class="roadmap-step done">
                              <span class="step-label">Captura de Datos</span>
                              <span class="step-meta">Recibido 05 Ene</span>
                            </div>
                            <div class="roadmap-step done">
                              <span class="step-label">Cuestionario de Riesgo</span>
                              <span class="step-meta">Completo</span>
                            </div>
                            <div class="roadmap-step in-progress">
                              <span class="step-label">Suscripci√≥n T√©cnica</span>
                              <span class="step-meta">En revisi√≥n</span>
                            </div>
                            <div class="roadmap-step pending">
                              <span class="step-label">Emisi√≥n & Bienvenida</span>
                              <span class="step-meta">Pendiente</span>
                            </div>
                          </div>
                          <div class="roadmap-status hidden" data-client="CR">
                            <div class="roadmap-step done">
                              <span class="step-label">Captura de Datos</span>
                              <span class="step-meta">Recibido 03 Ene</span>
                            </div>
                            <div class="roadmap-step in-progress">
                              <span class="step-label">Cuestionario de Riesgo</span>
                              <span class="step-meta">Enviado ‚Ä¢ esperando respuestas</span>
                            </div>
                            <div class="roadmap-step pending">
                              <span class="step-label">Suscripci√≥n T√©cnica</span>
                              <span class="step-meta">Pendiente</span>
                            </div>
                            <div class="roadmap-step pending">
                              <span class="step-label">Emisi√≥n & Bienvenida</span>
                              <span class="step-meta">Pendiente</span>
                            </div>
                          </div>
                          <div class="roadmap-status hidden" data-client="AM">
                            <div class="roadmap-step done">
                              <span class="step-label">Captura de Datos</span>
                              <span class="step-meta">Recibido 28 Dic</span>
                            </div>
                            <div class="roadmap-step done">
                              <span class="step-label">Cuestionario de Riesgo</span>
                              <span class="step-meta">Completo</span>
                            </div>
                            <div class="roadmap-step done">
                              <span class="step-label">Suscripci√≥n T√©cnica</span>
                              <span class="step-meta">Aprobado</span>
                            </div>
                            <div class="roadmap-step in-progress">
                              <span class="step-label">Emisi√≥n & Bienvenida</span>
                              <span class="step-meta">Emitido, enviar kit</span>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="content-card compact">
                        <div class="card-header-modern">
                          <h3>Siniestros En Curso</h3>
                          <div class="header-actions tight">
                            <button class="btn-icon-sm" onclick="window.appHandlers?.fileClaim?.()" title="Nuevo siniestro">
                              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                              </svg>
                            </button>
                          </div>
                        </div>
                        <div class="claims-interactive-list">
                          <div class="claim-item warn">
                            <div class="claim-icon">
                              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                              </svg>
                            </div>
                            <div class="claim-content">
                              <div class="claim-header">
                                <strong>#SIN-2026-001</strong>
                                <span class="claim-status warn">En revisi√≥n</span>
                              </div>
                              <p>Auto - Colisi√≥n | Mar√≠a Gonz√°lez</p>
                              <div class="claim-meta">
                                <span>05 Ene 2026</span>
                                <span class="claim-amount">$12,500</span>
                              </div>
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="window.appHandlers?.viewClaim?.('SIN-2026-001')">Ver</button>
                          </div>
                          <div class="claim-item ok">
                            <div class="claim-icon">
                              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                              </svg>
                            </div>
                            <div class="claim-content">
                              <div class="claim-header">
                                <strong>#SIN-2025-089</strong>
                                <span class="claim-status ok">Aprobado</span>
                              </div>
                              <p>Hogar - Robo | Carlos Ruiz</p>
                              <div class="claim-meta">
                                <span>20 Dic 2025</span>
                                <span class="claim-amount">$8,300</span>
                              </div>
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="window.appHandlers?.viewClaim?.('SIN-2025-089')">Ver</button>
                          </div>
                          <div class="claim-item urgent">
                            <div class="claim-icon">
                              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 9v4"/>
                                <path d="M12 17h.01"/>
                                <path d="m10.29 3.86-8.27 14.3A2 2 0 0 0 3.73 21h16.54a2 2 0 0 0 1.71-2.84l-8.27-14.3a2 2 0 0 0-3.42 0Z"/>
                              </svg>
                            </div>
                            <div class="claim-content">
                              <div class="claim-header">
                                <strong>#SIN-2026-002</strong>
                                <span class="claim-status urgent">Urgente</span>
                              </div>
                              <p>Vida - Accidente | Ana Mart√≠nez</p>
                              <div class="claim-meta">
                                <span>08 Ene 2026</span>
                                <span class="claim-amount">$45,000</span>
                              </div>
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="window.appHandlers?.viewClaim?.('SIN-2026-002')">Ver</button>
                          </div>
                        </div>
                      </div>

                      <div class="subgrid two">
                        <div class="chart-card" onclick="window.appHandlers?.openSalesModal?.()" style="cursor: pointer;">
                          <div class="chart-header">
                            <h3 class="chart-title">
                              <span class="icon-animated" aria-hidden="true">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                  <polyline points="3 17 8 11 13 14 21 6" />
                                  <polyline points="14 6 21 6 21 13" />
                                </svg>
                              </span>
                              Ventas del Mes
                            </h3>
                            <div class="chart-legend">
                              <span class="chart-legend-item"><span class="chart-legend-dot"></span> Ventas</span>
                              <span class="chart-legend-item" style="color: var(--theme-accent-color);">+22.3% vs mes anterior</span>
                            </div>
                          </div>
                          <div class="chart-body">
                            <div class="sparkline-placeholder" aria-hidden="true"></div>
                          </div>
                          <div class="chart-metrics">
                            <div class="chart-metric">
                              <span class="label">P√≥lizas vendidas</span>
                              <span class="value">18</span>
                            </div>
                            <div class="chart-metric">
                              <span class="label">Renovaciones</span>
                              <span class="value">12</span>
                            </div>
                            <div class="chart-metric">
                              <span class="label">Cotizaciones</span>
                              <span class="value">25</span>
                            </div>
                          </div>
                        </div>

                        <div class="chart-card" onclick="window.appHandlers?.openCommissionsModal?.()" style="cursor: pointer;">
                          <div class="chart-header">
                            <h3 class="chart-title">
                              <span class="icon-animated" aria-hidden="true">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                  <line x1="12" y1="1" x2="12" y2="23"/>
                                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                </svg>
                              </span>
                              Comisiones
                            </h3>
                            <div class="chart-legend">
                              <span class="chart-legend-item"><span class="chart-legend-dot" style="background: #38ef7d; box-shadow: 0 0 0 4px rgba(56, 239, 125, 0.12);"></span> Ganadas</span>
                              <span class="chart-legend-item"><span class="chart-legend-dot" style="background: #f5576c; box-shadow: 0 0 0 4px rgba(245, 87, 108, 0.12);"></span> Pendientes</span>
                            </div>
                          </div>
                          <div class="chart-body">
                            <div class="sparkline-placeholder" aria-hidden="true"></div>
                          </div>
                          <div class="chart-metrics">
                            <div class="chart-metric">
                              <span class="label">Este mes</span>
                              <span class="value">$45.3K</span>
                            </div>
                            <div class="chart-metric">
                              <span class="label">Pendiente</span>
                              <span class="value">$8.5K</span>
                            </div>
                            <div class="chart-metric">
                              <span class="label">Promedio</span>
                              <span class="value">$42.1K</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div><!-- .stage-main -->
      </div><!-- .dashboard-stage -->
    </div><!-- .dashboard-main-wrapper -->

    <aside class="dashboard-rail right-rail rail-surface">
      <div class="content-card compact">
        <div class="card-header-modern">
          <h3>üìä Estado de Cotizaciones</h3>
          <span class="card-badge">8 activas</span>
        </div>
        <div class="quotes-status-list">
          <div class="status-item">
            <span class="status-dot pending"></span>
            <span class="status-text">Pendientes</span>
            <span class="status-count">5</span>
          </div>
          <div class="status-item">
            <span class="status-dot in-progress"></span>
            <span class="status-text">En revisi√≥n</span>
            <span class="status-count">2</span>
          </div>
          <div class="status-item">
            <span class="status-dot approved"></span>
            <span class="status-text">Aprobadas</span>
            <span class="status-count">1</span>
          </div>
          <button class="btn btn-sm btn-outline" style="width: 100%; margin-top: 12px;" onclick="window.appHandlers?.openQuotes?.()">
            Ver todas las cotizaciones
          </button>
        </div>
      </div>

      <div class="content-card compact">
        <div class="card-header-modern">
          <h3>Actividad Reciente</h3>
          <span class="card-badge">Live</span>
        </div>
        <div class="activity-list card-body-scroll" data-agent-activity>
          <div class="activity-item">
            <div class="activity-icon success">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
            <div class="activity-content">
              <strong>P√≥liza vendida</strong>
              <span>AUTO-156 - Mar√≠a Gonz√°lez</span>
              <span class="activity-time">Hace 2 horas</span>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon info">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16v16H4z"/>
              </svg>
            </div>
            <div class="activity-content">
              <strong>Cotizaci√≥n enviada</strong>
              <span>#COT-2026-045 - Pedro S√°nchez</span>
              <span class="activity-time">Hace 4 horas</span>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon warning">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 9v4"/>
                <path d="M12 17h.01"/>
              </svg>
            </div>
            <div class="activity-content">
              <strong>Renovaci√≥n pendiente</strong>
              <span>HOME-001 - Carlos Ruiz</span>
              <span class="activity-time">Hace 1 d√≠a</span>
            </div>
          </div>
        </div>
      </div>
    </aside><!-- .dashboard-rail -->
  </div><!-- .dashboard-layout -->
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Tabs (if present)
    const tabs = document.querySelectorAll('#agent-tabs .dashboard-tab');
    const panels = document.querySelectorAll('#agent-panels .tab-panel');
    const navItems = document.querySelectorAll('.agent-dashboard .dashboard-sidebar .nav-item[data-target]');

    const setActive = (targetId) => {
      tabs.forEach(btn => {
        const isActive = btn.getAttribute('data-target') === targetId;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-pressed', isActive);
      });
      navItems.forEach(link => {
        const isActive = link.getAttribute('data-target') === targetId;
        link.classList.toggle('active', isActive);
      });
      panels.forEach(panel => panel.classList.toggle('active', panel.id === targetId));
    };

    tabs.forEach(tab => {
      tab.addEventListener('click', () => setActive(tab.getAttribute('data-target')));
    });

    navItems.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        setActive(link.getAttribute('data-target'));
      });
    });

    // Roadmap tabs inside agent dashboard
    const roadmapTabs = document.querySelectorAll('.agent-dashboard .roadmap-tab');
    const roadmapPanels = document.querySelectorAll('.agent-dashboard .roadmap-status');
    const activateRoadmap = (client) => {
      if (!client) return;
      roadmapTabs.forEach(tab => {
        const isActive = tab.getAttribute('data-client') === client;
        tab.classList.toggle('active', isActive);
        tab.setAttribute('aria-pressed', isActive);
      });
      roadmapPanels.forEach(panel => {
        panel.classList.toggle('hidden', panel.getAttribute('data-client') !== client);
      });
    };

    roadmapTabs.forEach(tab => {
      tab.addEventListener('click', () => activateRoadmap(tab.getAttribute('data-client')));
    });

    if (roadmapTabs.length) {
      activateRoadmap(roadmapTabs[0].getAttribute('data-client'));
    }

    // Agent data from session
    const agentName = window.dashboardData?.user?.name || 'Guillermo Krause';
    const agentId = window.dashboardData?.user?.id || 'AG-2024-001';
    const initials = agentName.split(' ').map(n => n[0]).join('').toUpperCase();

    const agentNameEl = document.querySelector('[data-agent-name]');
    const agentIdEl = document.querySelector('[data-agent-id]');
    const agentInitialsEl = document.querySelector('[data-agent-initials]');

    if (agentNameEl) agentNameEl.textContent = agentName;
    if (agentIdEl) agentIdEl.textContent = agentId;
    if (agentInitialsEl) agentInitialsEl.textContent = initials;

    // Load dashboard data from backend API
    if (typeof loadAgentDashboard === 'function') {
      loadAgentDashboard().catch(error => {
        console.error('Error loading agent dashboard:', error);
      });
    }

    // Initialize Payment Proof Review Component SOLO si hay sesi√≥n de agente
    if (typeof ProofReviewComponent !== 'undefined') {
      // Verificar que haya usuario logueado como agente
      const userSession = sessionStorage.getItem('user');
      if (!userSession) {
        console.log('No agent session - skipping proof review initialization');
        return;
      }

      const user = JSON.parse(userSession);
      if (user.type !== 'agent') {
        console.log('User is not an agent - skipping proof review initialization');
        return;
      }

      const proofContainer = document.getElementById('proof-review-container');
      if (proofContainer) {
        try {
          const proofReview = new ProofReviewComponent('proof-review-container');
          proofReview.render();
          
          // Update badge with count
          proofReview.onCountUpdate = (count) => {
            const badge = document.getElementById('proof-count-badge');
            if (badge) badge.textContent = count;
          };
          
          // Auto-refresh every 30 seconds
          setInterval(() => proofReview.render(), 30000);
        } catch (error) {
          console.error('Error initializing proof review:', error);
        }
      }
    } else {
      console.warn('ProofReviewComponent not loaded. Make sure paymentIntegration.js is included.');
    }

    // Policy Upload Form Handler
    const policyForm = document.getElementById('policy-upload-form');
    if (policyForm && typeof PaymentAPI !== 'undefined') {
      policyForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData(policyForm);
        const progressDiv = document.getElementById('extraction-progress');
        const resultsDiv = document.getElementById('extraction-results');
        const extractedDataDiv = document.getElementById('extracted-data');
        
        // Show progress
        progressDiv.style.display = 'block';
        resultsDiv.style.display = 'none';
        
        try {
          const response = await PaymentAPI.uploadPolicy(formData);
          
          // Hide progress
          progressDiv.style.display = 'none';
          
          if (response.success) {
            // Show extracted data
            const data = response.extracted_data;
            const html = `
              <div style="margin-bottom: 8px;"><strong>Prima Mensual:</strong> $${data.monthly_premium || 'No detectado'} <span style="color: ${data.confidence_premium === 'high' ? 'green' : data.confidence_premium === 'medium' ? 'orange' : 'red'};">(${data.confidence_premium})</span></div>
              <div style="margin-bottom: 8px;"><strong>Fecha Emisi√≥n:</strong> ${data.issue_date || 'No detectado'} <span style="color: ${data.confidence_dates === 'high' ? 'green' : data.confidence_dates === 'medium' ? 'orange' : 'red'};">(${data.confidence_dates})</span></div>
              <div style="margin-bottom: 8px;"><strong>Fecha Vencimiento:</strong> ${data.expiration_date || 'No detectado'}</div>
              <div style="margin-bottom: 8px;"><strong>Periodicidad:</strong> ${data.payment_periodicity || 'No detectado'}</div>
              <div style="margin-bottom: 8px;"><strong>Aseguradora:</strong> ${data.insurer || 'No detectado'} <span style="color: ${data.confidence_insurer === 'high' ? 'green' : data.confidence_insurer === 'medium' ? 'orange' : 'red'};">(${data.confidence_insurer})</span></div>
              ${data.low_confidence_warning ? '<div style="margin-top: 12px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 0.875rem;">‚ö†Ô∏è Algunos datos tienen baja confianza. Revisa y ajusta manualmente.</div>' : ''}
            `;
            extractedDataDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            
            // Show success notification
            if (window.showNotification) {
              window.showNotification('P√≥liza procesada exitosamente. ID: ' + response.policy_id, 'success');
            }
            
            // Refresh proof review component if available
            if (window.proofReviewComponent) {
              setTimeout(() => window.proofReviewComponent.render(), 1000);
            }

            // Refresh agent dashboard panels
            if (window.agentDashboard) {
              setTimeout(() => {
                window.agentDashboard.paymentPanel?.render();
                window.agentDashboard.policiesPanel?.render();
              }, 1000);
            }
            
            // Reset form after 3 seconds
            setTimeout(() => {
              policyForm.reset();
              resultsDiv.style.display = 'none';
            }, 3000);
            
          } else {
            throw new Error(response.message || 'Error al procesar p√≥liza');
          }
        } catch (error) {
          progressDiv.style.display = 'none';
          console.error('Error uploading policy:', error);
          if (window.showNotification) {
            window.showNotification('Error al procesar p√≥liza: ' + error.message, 'error');
          }
        }
      });
    }
  });
</script>

<!-- Agent Dashboard Components -->
